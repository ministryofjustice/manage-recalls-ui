{% extends "../partials/layout.njk" %}

{% set pageTitle = applicationName + " - Book a recall - Check the details before booking this recall" %}

{% block beforeContent %}
    {{ govukBackLink({
        text: "Back",
        href: "/persons/" + person.nomsNumber + "/recalls/" + recall.recallId + "/upload-documents"
    }) }}
{% endblock %}

{% block content %}

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% if errors %}
                {{ govukErrorSummary({
                    titleText: "There is a problem",
                    errorList: errors.list,
                    attributes: {
                        'data-qa': 'error-list'
                    }
                }) }}
            {% endif %}
            <h1 class="govuk-heading-l">
                Check the details before booking this recall
            </h1>
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds-from-desktop">

            <h2 class='govuk-heading-m'>Personal details</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Name
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='name'>
                        {{ person.firstName }} {{ person.lastName }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Date of birth
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='dateOfBirth'>
                        {{ person.dateOfBirth | dateTime }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Gender
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='gender'>
                        {{ person.gender }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        NOMIS
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='nomsNumber'>
                        {{ person.nomsNumber }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        CRO
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='croNumber'>
                        {{ person.croNumber }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Name on pre-cons
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='previousConvictionMainName'>
                        {{ recall.previousConvictionMainName }}
                    </dd>
                </div>
            </dl>

            <h2 class='govuk-heading-m govuk-!-margin-top-9'>Recall request date and time</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Recall email received
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='recallEmailReceivedDateTime'>
                        {{ recall.recallEmailReceivedDateTime | dateTime}}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Recall email uploaded
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='recallRequestEmailFileName'>
                        <a href='{{ recall.recallRequestEmail.url }}' class='govuk-link' data-qa='uploadedDocument-{{ recall.recallRequestEmail.category}}' download>{{ recall.recallRequestEmail.fileName }}</a>
                    </dd>
                </div>
            </dl>

            <h2 class='govuk-heading-m govuk-!-margin-top-9'>Sentence, offence and release details</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Sentence type
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='sentenceType'>
                        Determinate
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Date of sentence
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='sentenceDate'>
                        {{ recall.sentenceDate | dateTime }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Licence expiry date
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='licenceExpiryDate'>
                        {{ recall.licenceExpiryDate | dateTime }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Sentence expiry date
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='sentenceExpiryDate'>
                        {{ recall.sentenceExpiryDate | dateTime }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Length of sentence
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='sentenceLength'>
                        {% if recall.sentenceLength.years %}{{ recall.sentenceLength.years }} years {% endif %}{% if recall.sentenceLength.months %}{{ recall.sentenceLength.months }} months {% endif %}{% if recall.sentenceLength.days %}{{ recall.sentenceLength.days }} days{% endif %}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Sentencing court
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='sentencingCourt'>
                        {{ recall.sentencingCourt }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Index offence
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='indexOffence'>
                        {{ recall.indexOffence }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Releasing prison
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='lastReleasePrison'>
                        {{ recall.lastReleasePrisonFormatted }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Booking number
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='bookingNumber'>
                        {{ recall.bookingNumber }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Latest release date
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='lastReleaseDate'>
                        {{ recall.lastReleaseDate | dateTime }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Conditional release date
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='conditionalReleaseDate'>
                        {{ recall.conditionalReleaseDate | dateTime }}
                    </dd>
                </div>
            </dl>
            <h2 class='govuk-heading-m govuk-!-margin-top-9'>Local police force</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Name
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='localPoliceForce'>
                        {{ recall.localPoliceForce }}
                    </dd>
                </div>
            </dl>

            <h2 class='govuk-heading-m govuk-!-margin-top-9'>Issues or needs</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Vulnerability and diversity
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half">
                        {% if recall.vulnerabilityDiversityDetail %}<pre class='govuk-body' data-qa='vulnerabilityDiversityDetail'>{{ recall.vulnerabilityDiversityDetail }}</pre>{% else %}No{% endif %}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Contraband
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half">
                        {% if recall.contrabandDetail %}<pre class='govuk-body' data-qa='contrabandDetail'>{{ recall.contrabandDetail }}</pre>{% else %}No{% endif %}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        MAPPA level
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='mappaLevel'>
                        {{ recall.mappaLevelFormatted }}
                    </dd>
                </div>
            </dl>

            <h2 class='govuk-heading-m govuk-!-margin-top-9'>Probation details</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Probation officer
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half">
                        <p class='govuk-body' data-qa='probationOfficerName'>{{ recall.probationOfficerName }}</p>
                        <p class='govuk-body'><a class='govuk-link' href='mailto:{{ recall.probationOfficerEmail }}' data-qa='probationOfficerEmail'>{{ recall.probationOfficerEmail }}</a></p>
                        <p class='govuk-body' data-qa='probationOfficerPhoneNumber'>{{ recall.probationOfficerPhoneNumber }}</p>
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        Local Delivery Unit
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='localDeliveryUnit'>
                        {{ recall.localDeliveryUnitFormatted }}
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        ACO
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half" data-qa='authorisingAssistantChiefOfficer'>
                        {{ recall.authorisingAssistantChiefOfficer }}
                    </dd>
                </div>
            </dl>
            <h2 class='govuk-heading-m govuk-!-margin-top-9'>Uploaded documents</h2>
            <dl class="govuk-summary-list">
                {% for document in recall.documents %}
                <div class="govuk-summary-list__row">
                    <dt class=" govuk-summary-list__key govuk-!-width-one-half">
                        {{ document.label }}
                    </dt>
                    <dd class=" govuk-summary-list__value govuk-!-width-one-half">
                        <a class='govuk-link' href='{{ document.url }}' target='_blank' data-qa='uploadedDocument-{{ document.category }}'>{{ document.fileName }}</a>
                    </dd>
                </div>
                {% endfor %}
            </dl>
            <div class="govuk-form-group govuk-!-margin-top-9">
                <form novalidate action="/persons/{{ person.nomsNumber }}/recalls/{{ recall.recallId }}/check-answers" method="post">
                    <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
                    <button class="govuk-button" data-qa='continueButton'>
                        Complete booking
                    </button>
                </form>
            </div>

        </div>
    </div>

{% endblock %}
